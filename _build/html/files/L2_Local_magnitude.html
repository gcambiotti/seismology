
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8. Local magnitude &#8212; Seismology</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Earthquake localization" href="L3_Earthquake_localization.html" />
    <link rel="prev" title="7. Waveform processing" href="L1_Waveforms.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/gc_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Seismology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="A0_Setup.html">
   1. Working with JupyterLab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="A1_Tutorial.html">
   2. Tutorial on Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="C0_Harmonic.html">
   3. Harmonic oscillators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="C1_Fourier.html">
   4. Fourier transform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="C2_Discrete.html">
   5. Discrete Fourier transform
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratory
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="L0_Seismic_catalogs_and_networks.html">
   6. Seismic catalogs and networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L1_Waveforms.html">
   7. Waveform processing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Local magnitude
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L3_Earthquake_localization.html">
   9. Earthquake localization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Z0_Dirac.html">
   10. Dirac delta function
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Z1_Geographic_Maps.html">
   11. Geographic maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Z2_Inverse_Theory.html">
   12. Inverse problem theory
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Libraries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Z3_Libraries.html">
   13. Libraries
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-wood-andersoon-seismometer">
   8.1. The Wood-Andersoon seismometer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation">
   8.2. Implementation
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Local magnitude</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-wood-andersoon-seismometer">
   8.1. The Wood-Andersoon seismometer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation">
   8.2. Implementation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="local-magnitude">
<h1><span class="section-number">8. </span>Local magnitude<a class="headerlink" href="#local-magnitude" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="sections">
<p class="topic-title">Sections</p>
<ul class="simple">
<li><p><a class="reference internal" href="#the-wood-andersoon-seismometer" id="id1">The Wood-Andersoon seismometer</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id2">Implementation</a></p></li>
</ul>
</div>
<div class="full-width docutils">
<p>The (Richter or) local magnitude <span class="math notranslate nohighlight">\(M_L\)</span> is defined as</p>
<div class="math notranslate nohighlight" id="equation-m-1">
<span class="eqno">(8.1)<a class="headerlink" href="#equation-m-1" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp; M_L = \log_{10}\left(\frac{A}{\mathrm{m}}\right) + 6 + Z(r)
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is the maximum amplitude on a Wood-Anderson seismogram (Anderson and Wood 1925), <span class="math notranslate nohighlight">\(r\)</span> is the hypocentral distance and <span class="math notranslate nohighlight">\(Z\)</span> is a distance correction that, according to Hutton and Boore (1996), reads</p>
<div class="math notranslate nohighlight" id="equation-m-2">
<span class="eqno">(8.2)<a class="headerlink" href="#equation-m-2" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp; Z(r) = a\,\log_{10}\left(\frac{r}{100\,\mathrm{km}}\right) + b\,\left(\frac{r}{100\,\mathrm{km}}-1\right)  
\end{align}
\]</div>
<p>Here <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are two constants accounting for the geometrical spreading and the anaelastic attenuation. For crustal earthquakes in regions with attenuative properties similar to those of Southern California, the values proposed by the <a class="reference external" href="http://iaspei.org/">International Association of Seismology and Physics of the Earth’s Interior (IASPEI)</a> are <span class="math notranslate nohighlight">\(a=1.110\)</span> and <span class="math notranslate nohighlight">\(b=0.189\)</span>. We note that</p>
<div class="math notranslate nohighlight" id="equation-m-3">
<span class="eqno">(8.3)<a class="headerlink" href="#equation-m-3" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp; Z(100\,\mathrm{km}) = 0
\end{align}
\]</div>
<p>In order to anchor this magnitude scale to some particular number, a magnitude <span class="math notranslate nohighlight">\(M_L=3\)</span> earthquake at <span class="math notranslate nohighlight">\(100\,\mathrm{km}\)</span> distance was defined to have maximum amplitude of <span class="math notranslate nohighlight">\(1\,\mathrm{mm}\)</span> on the Wood-Anderson seismogram. Even better, we could say that  a magnitude <span class="math notranslate nohighlight">\(M_L=0\)</span> earthquake at <span class="math notranslate nohighlight">\(100\,\mathrm{km}\)</span> distance was defined to have maximum amplitude of <span class="math notranslate nohighlight">\(1\,\mu\mathrm{m}\)</span> on the Wood-Anderson seismogram.</p>
<p>The specific form of the distance correction function comes from the following simple model of the dependence of the displacement amplitude on the hypocentral distance, which accounts both for the geometrical spreading and for the anaelastic attenuation,</p>
<div class="math notranslate nohighlight" id="equation-m-4">
<span class="eqno">(8.4)<a class="headerlink" href="#equation-m-4" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp; A \propto r^{-\gamma}\,e^{-\frac{\omega\,r}{2\,c_s\,Q_s(\omega)}}
\end{align}
\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\gamma\)</span> is the geometrical spreading (which shoulb be equal to <span class="math notranslate nohighlight">\(1\)</span> for body waves and <span class="math notranslate nohighlight">\(1/2\)</span> for surface waves), <span class="math notranslate nohighlight">\(\omega\)</span> is the angular frequency, <span class="math notranslate nohighlight">\(c_s\)</span> is the S-wave velocity (the maximum amplitude is often due to S-wave) and <span class="math notranslate nohighlight">\(Q_s\)</span> is the (shear) quality factor (which is inversely proportional to the analeastic attenuation and can depend on the angular frequency).</p>
<p>Thanks to this correction, as far as it is accurate, it does not matter how far the seismic station is from the hypocentre. Seismic stations at different distances should provide the same estimate of the magnitude.</p>
</div>
<section id="the-wood-andersoon-seismometer">
<h2><a class="toc-backref" href="#id1"><span class="section-number">8.1. </span>The Wood-Andersoon seismometer</a><a class="headerlink" href="#the-wood-andersoon-seismometer" title="Permalink to this headline">#</a></h2>
<div class="full-width docutils">
<p>Although designed differently from a classical mechanical seismometer (i.e. a mass-spring-dash pot system), the Wood-Andersoon seismometer responds to ground motion as a driven harmonic oscillator but for an additional gain achieved through the optical system used for photographic recording.</p>
<p>The natural period <span class="math notranslate nohighlight">\(T_0\)</span> and damping constant <span class="math notranslate nohighlight">\(\xi\)</span> of the Wood-Andersoon seismometer are <span class="math notranslate nohighlight">\(T_0=0.8\,\mathrm{s}\)</span> and <span class="math notranslate nohighlight">\(\xi=0.7\)</span> and the nominal gain was <span class="math notranslate nohighlight">\(2800\)</span>. It has later been determined that the gain in reality was only <span class="math notranslate nohighlight">\(2080 \pm 60\)</span> (Urhammer and Collins 1990), which is important, since local magnitude scales made today refer to the <em>theoretical</em> output of this seismograph.</p>
</div>
<div class="full-width admonition note">
<p class="admonition-title">Note</p>
<p>We recall that the output of a Wood-Andersoon seismograph is not in counts but, recording displacements photographically, has the dimension of a length. It is indeed a pendulum type instrument  consisting of a metal cylinder tautly attached to an eccentric vertical suspension wire as shown in <a class="reference internal" href="#fig-wood-anderson"><span class="std std-numref">Figure 8.1</span></a>. The cylinder will rotate around the wire and a mirror, attached to the mass, is used for photographic recording of the displacement. The damping of the mass rotation is achieved by a magnetic flux (from a magnet) normal to the mass motion. As the mass is conductive, the stray current induced opposes to motion and is proportional to the mass velocity. The suspension wire may also vibrate with string modes, but these are effectively damped mechanically by two oil drops in contact with the wire.</p>
</div>
<figure class="align-center" id="fig-wood-anderson">
<img alt="../_images/wood_andersoon.png" src="../_images/wood_andersoon.png" />
<figcaption>
<p><span class="caption-number">Fig. 8.1 </span><span class="caption-text">The Wood Anderson torsion seismometer shown schematically.  The copper cylindrical mass is suspended on an eccentric taut wire and can rotate slightly.  A magnet (not fully drawn) is used for damping the mass rotation. The transverse vibration of the wire is damped by two drops of oil. The height of the instrument is 36 cm.  Figure taken from Havskov and Alguacil (2016).</span><a class="headerlink" href="#fig-wood-anderson" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id2"><span class="section-number">8.2. </span>Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">#</a></h2>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> widget
<span class="kn">import</span> <span class="nn">lab</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="kn">import</span> <span class="n">read_events</span>
<span class="kn">from</span> <span class="nn">obspy.core.inventory</span> <span class="kn">import</span> <span class="n">read_inventory</span>

<span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;Amatrice-Norcia-Visso/&quot;</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">directory</span><span class="o">+</span><span class="s2">&quot;Seismic_Inventory.xml&quot;</span>
<span class="n">inventory</span> <span class="o">=</span> <span class="n">read_inventory</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;7073641_Accumuli.xml&quot;</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">read_events</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>From the catalog, we select the Accumuli earthquake, its preferred origin and the associate magnitude</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">preferred_origin</span><span class="p">()</span>

<span class="k">for</span> <span class="n">magnitude</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">origin_id</span> <span class="o">==</span> <span class="n">origin</span><span class="o">.</span><span class="n">resource_id</span><span class="p">:</span> <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ASSOCIATED MAGNITUDE:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">magnitude</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ASSOCIATED MAGNITUDE:

 Magnitude
	    resource_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?magnitudeId=29758611&quot;)
	            mag: 6.0 [uncertainty=0.3]
	 magnitude_type: &#39;ML&#39;
	      origin_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?originId=27629391&quot;)
	      method_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?methodId=1&quot;)
	  station_count: 159
	  creation_info: CreationInfo(agency_id=&#39;INGV&#39;, author=&#39;Bollettino Sismico Italiano INGV&#39;, creation_time=UTCDateTime(2016, 8, 30, 10, 32, 53))
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>From the inventory we select the “IV.MRLC” seismic station</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">net_code</span><span class="p">,</span> <span class="n">sta_code</span> <span class="o">=</span> <span class="s2">&quot;IV&quot;</span><span class="p">,</span> <span class="s2">&quot;MRLC&quot;</span>

<span class="n">inv</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">net_code</span><span class="p">,</span><span class="n">station</span><span class="o">=</span><span class="n">sta_code</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">station</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>and we calculate the epicentral and hypocentral distances, as well as the distance correction as defined by eq. <a class="reference internal" href="#equation-m-2">(8.2)</a></p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geopy</span> <span class="kn">import</span> <span class="n">distance</span> <span class="k">as</span> <span class="n">geopy_distance</span>

<span class="n">distance</span> <span class="o">=</span> <span class="n">geopy_distance</span><span class="o">.</span><span class="n">distance</span><span class="p">((</span><span class="n">station</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span><span class="n">station</span><span class="o">.</span><span class="n">longitude</span><span class="p">),(</span><span class="n">origin</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span><span class="n">origin</span><span class="o">.</span><span class="n">longitude</span><span class="p">))</span><span class="o">.</span><span class="n">km</span>
<span class="n">distance_deg</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="mi">6371</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance: </span><span class="si">{0:6.1f}</span><span class="s2"> [km] or </span><span class="si">{0:6.3f}</span><span class="s2"> [deg]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">distance_deg</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">eva_distance_correction</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span> 

    <span class="n">r0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">1.110</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.189</span>

    <span class="n">distance_correction</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="n">r0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="n">r0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distance_correction</span>

<span class="n">depth</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">depth</span> <span class="o">/</span> <span class="mf">1e3</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">distance</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">depth</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">distance_correction</span> <span class="o">=</span> <span class="n">eva_distance_correction</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance correction:&quot;</span><span class="p">,</span><span class="n">distance_correction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distance:  285.9 [km] or 285.870 [deg]
Distance correction: 0.8580508733906258
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>Let us now read the raw data from the IV.MRLC station and perform the preprocessing discussed in  <a class="reference internal" href="L1_Waveforms.html#chap-w"><span class="std std-numref">Lecture 7</span></a> <a class="reference internal" href="L1_Waveforms.html#chap-w"><span class="std std-ref">Waveform processing</span></a> and do the same also for the noise before the origin time</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">read</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">directory</span><span class="o">+</span><span class="s2">&quot;IV.MRLC_Long.mseed&quot;</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">attach_response</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="n">endtime</span><span class="o">=</span><span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="o">+</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">noise</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">endtime</span><span class="o">=</span><span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">lab</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>In order to understand how filter the waveforms, we compare the spectra of the waveforms with those of the only noise</p>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         network: IV
         station: MRLC
        location: 
         channel: HHE
       starttime: 2016-08-24T01:28:12.000000Z
         endtime: 2016-08-24T02:18:12.030000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 300004
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 1561, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 12, 30000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s (None) to count (None)
	Overall Sensitivity: 1.5e+09 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s to V, gain: 1500
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 1e+06
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
         network: IV
         station: MRLC
        location: 
         channel: HHN
       starttime: 2016-08-24T01:28:12.000000Z
         endtime: 2016-08-24T02:18:12.030000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 300004
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 2009, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 12, 30000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s (None) to count (None)
	Overall Sensitivity: 1.5e+09 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s to V, gain: 1500
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 1e+06
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
         network: IV
         station: MRLC
        location: 
         channel: HHZ
       starttime: 2016-08-24T01:28:12.000000Z
         endtime: 2016-08-24T02:18:12.030000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 300004
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 1783, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 12, 30000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s (None) to count (None)
	Overall Sensitivity: 1.5e+09 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s to V, gain: 1500
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 1e+06
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
         network: IV
         station: MRLC
        location: 
         channel: HNE
       starttime: 2016-08-24T01:28:12.000000Z
         endtime: 2016-08-24T02:18:12.030000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 300004
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 1115, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 12, 30000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s**2 (None) to count (None)
	Overall Sensitivity: 407880 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s**2 to V, gain: 1.0197
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 400000
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
         network: IV
         station: MRLC
        location: 
         channel: HNN
       starttime: 2016-08-24T01:28:12.890000Z
         endtime: 2016-08-24T02:18:11.200000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 299832
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 732, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 11, 200000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s**2 (None) to count (None)
	Overall Sensitivity: 407880 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s**2 to V, gain: 1.0197
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 400000
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
         network: IV
         station: MRLC
        location: 
         channel: HNZ
       starttime: 2016-08-24T01:28:12.000000Z
         endtime: 2016-08-24T02:18:12.030000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 300004
           calib: 1.0
         _format: MSEED
           mseed: AttribDict({&#39;dataquality&#39;: &#39;D&#39;, &#39;number_of_records&#39;: 424, &#39;encoding&#39;: &#39;STEIM2&#39;, &#39;byteorder&#39;: &#39;&gt;&#39;, &#39;record_length&#39;: 512, &#39;filesize&#39;: 5043712})
      processing: [&#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 1, 53, 12)::fill_value=None::nearest_sample=True::pad=False::starttime=UTCDateTime(2016, 8, 24, 1, 28, 12))&#39;, &quot;ObsPy 1.4.0: detrend(options={&#39;order&#39;: 1}::type=&#39;polynomial&#39;)&quot;, &quot;ObsPy 1.4.0: taper(max_length=None::max_percentage=0.05::side=&#39;both&#39;::type=&#39;cosine&#39;)&quot;, &#39;ObsPy 1.4.0: trim(endtime=UTCDateTime(2016, 8, 24, 2, 18, 12, 30000)::fill_value=0::nearest_sample=True::pad=True::starttime=None)&#39;]
        response: Channel Response
	From m/s**2 (None) to count (None)
	Overall Sensitivity: 407880 defined at 0.200 Hz
	5 stages:
		Stage 1: PolesZerosResponseStage from m/s**2 to V, gain: 1.0197
		Stage 2: CoefficientsTypeResponseStage from V to count, gain: 400000
		Stage 3: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 4: CoefficientsTypeResponseStage from count to count, gain: 1
		Stage 5: CoefficientsTypeResponseStage from count to count, gain: 1
</pre></div>
</div>
</div>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ground</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;DISP&quot;</span><span class="p">)</span>
<span class="n">ground_noise</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;DISP&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_fft</span><span class="p">(</span><span class="n">ground</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_fft</span><span class="p">(</span><span class="n">ground_noise</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">extra_label</span><span class="o">=</span><span class="s2">&quot;noise&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

<span class="n">fs</span> <span class="o">=</span> <span class="mf">1e1</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">5e-3</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span><span class="mf">2e-4</span><span class="o">/</span><span class="n">fs</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/L2_Local_magnitude_16_0.png" src="../_images/L2_Local_magnitude_16_0.png" />
</div>
</div>
<div class="full-width docutils">
<p>We set and apply the following zero-phase fourth-order band-pass Butterworth filter</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>

<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1e-2</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mf">1e-2</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mf">5e-3</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mf">2e-2</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mf">2e-2</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mf">2e-2</span><span class="p">,</span><span class="mi">15</span><span class="p">]])</span>

<span class="n">BA_filters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
    <span class="n">BA_filter</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">band</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">BA_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BA_filter</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">lab</span>
<span class="n">filtered_zerophase_stream</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">filtering_zerophase</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="n">BA_filters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>and we check the estimated ground motion by comparing the results from the velocimeter and the accelerometer</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">output</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="p">[</span><span class="s2">&quot;ACC&quot;</span><span class="p">,</span><span class="s2">&quot;VEL&quot;</span><span class="p">,</span><span class="s2">&quot;DISP&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Acceleration [m/s$^2$]&quot;</span><span class="p">,</span> <span class="s2">&quot;Velocity [m/s]&quot;</span><span class="p">,</span> <span class="s2">&quot;Displacement [m]&quot;</span><span class="p">]</span> <span class="p">):</span>
    <span class="n">ground</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">filtered_zerophase_stream</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_time</span><span class="p">(</span><span class="n">ground</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;HH*&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_time</span><span class="p">(</span><span class="n">ground</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;HN*&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/L2_Local_magnitude_20_0.png" src="../_images/L2_Local_magnitude_20_0.png" />
<img alt="../_images/L2_Local_magnitude_20_1.png" src="../_images/L2_Local_magnitude_20_1.png" />
<img alt="../_images/L2_Local_magnitude_20_2.png" src="../_images/L2_Local_magnitude_20_2.png" />
</div>
</div>
<div class="full-width docutils">
<p>Let us now focus on the ground displacements</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ground</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">remove_response</span><span class="p">(</span><span class="n">filtered_zerophase_stream</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;DISP&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>and simulate the <em>theoretical</em> recording of the Wood-Anderson seismometer</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">theory</span> <span class="kn">import</span> <span class="n">eva_FT_response</span>

<span class="n">wood_gain</span> <span class="o">=</span> <span class="mi">2080</span>
<span class="n">wood_period</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">wood_damping</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">wood</span> <span class="o">=</span> <span class="n">ground</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">wood</span><span class="p">:</span>
    <span class="n">fs</span><span class="p">,</span><span class="n">Zs</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">get_fft_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fs</span>
    <span class="n">FT_response</span> <span class="o">=</span> <span class="n">eva_FT_response</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">natural_period</span><span class="o">=</span><span class="n">wood_period</span><span class="p">,</span> <span class="n">damping_ratio</span><span class="o">=</span><span class="n">wood_damping</span><span class="p">)</span>
    <span class="n">FT_response</span> <span class="o">*=</span> <span class="n">wood_gain</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">Zs</span> <span class="o">*</span> <span class="n">FT_response</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>Here the plot of the <em>theoretical</em> recording of the Wood-Anderson seismometer</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_time</span><span class="p">(</span><span class="n">wood</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;HH*&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">lab</span><span class="o">.</span><span class="n">plot_time</span><span class="p">(</span><span class="n">wood</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;HN*&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;WA recording [m]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/L2_Local_magnitude_26_0.png" src="../_images/L2_Local_magnitude_26_0.png" />
</div>
</div>
<div class="full-width docutils">
<p>Then, according to the definition of local magnitude, eq. <a class="reference internal" href="#equation-m-1">(8.1)</a>, we estimate the magnitude from both the velocimeter and the seismometer</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HH*&quot;</span><span class="p">,</span><span class="s2">&quot;HN*&quot;</span><span class="p">]:</span>
    <span class="n">MLs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">wood</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">):</span>
        <span class="n">ML</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">distance_correction</span>
        <span class="c1">#print(trace.id,ML)</span>
        <span class="n">MLs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ML</span><span class="p">)</span>
    <span class="n">ML</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MLs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;channel:&quot;</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="s2">&quot;  ML =&quot;</span><span class="p">,</span><span class="n">ML</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>channel: HH*   ML = 5.774745361018692
channel: HN*   ML = 5.7505927382214646
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<p>that are very close to each other and also consistent, within one-sigma error, with the estimate <span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">6.0</span></code></span><span class="math notranslate nohighlight">\(\pm\)</span><span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">0.3</span></code></span> of the Bollettino Sismico Italiano INGV</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Magnitude
	    resource_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?magnitudeId=29758611&quot;)
	            mag: 6.0 [uncertainty=0.3]
	 magnitude_type: &#39;ML&#39;
	      origin_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?originId=27629391&quot;)
	      method_id: ResourceIdentifier(id=&quot;smi:webservices.ingv.it/fdsnws/event/1/query?methodId=1&quot;)
	  station_count: 159
	  creation_info: CreationInfo(agency_id=&#39;INGV&#39;, author=&#39;Bollettino Sismico Italiano INGV&#39;, creation_time=UTCDateTime(2016, 8, 30, 10, 32, 53))
</pre></div>
</div>
</div>
</div>
<p style="page-break-after:always;"></p></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./files"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="L1_Waveforms.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Waveform processing</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="L3_Earthquake_localization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Earthquake localization</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By <a href="https://sites.unimi.it/gcambiotti/">Gabriele Cambiotti</a><br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>